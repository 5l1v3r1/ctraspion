#!/bin/sh
##
# c't-Raspion, a Raspberry Pi based all in one sniffer
# for judging on IoT and smart home devices activity
# (c) 2019-2020 c't magazin, Germany, Hannover
# see: https://ct.de/-123456 for more information
# 
# file          : postinst
# description   : postinst for raspion
# version       : 0.1
#       
# changes         
# author		: Benny Stark - github.com/Diggen85
# date          : 2020010
# notes         : Initial - based on dh
#               : do pkg-divert without config-package-dev
###
set -e

rm_divert() {
    local PKG_NAME="raspion"
    local CONF_FILE=$1

    #test if conf is divert else simple remove
    if  LC_ALL=C dpkg-divert --list "$PKG_NAME" | grep -xiqe "^diversion.*$CONF_FILE.*$PKG_NAME.*$"; then
        dpkg-divert --rename --package "$PKG_NAME" --remove $CONF_FILE
    else
        rm -f "$CONF_FILE"
    fi
}

case "$1" in
    remove|purge)
        rm_divert /etc/radvd.conf
        rm_divert /etc/hostapd/hostapd.conf
        rm_divert /etc/network/interfaces
        rm_divert /etc/default/shellinabox
        rm_divert /etc/gtk-3.0/settings.ini
        rm_divert /etc/ntopng/ntopng.conf
    ;;

    upgrade|failed-upgrade|abort-install|abort-upgrade|disappear)
        echo "something bad happend\n - take a break\n - better check confs and rerun configuration"
    ;;

    *)
        echo "postrm called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
